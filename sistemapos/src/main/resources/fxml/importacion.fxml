<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<BorderPane xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.nap.pos.ui.controller.ImportacionController"
            styleClass="wizard-root"
            stylesheets="@../css/setup_wizard.css,@../css/importacion.css"
            prefWidth="900" prefHeight="640">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CABECERA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <top>
    <VBox styleClass="wizard-header">
      <HBox alignment="CENTER_LEFT" spacing="16" style="-fx-padding: 18 32 18 32;">
        <Label text="NAP POS"            styleClass="wizard-brand"/>
        <Label text="â€”"                  styleClass="wizard-subtitle"/>
        <Label fx:id="lblTituloPaso"
               text="ImportaciÃ³n masiva" styleClass="wizard-subtitle"/>
        <Region HBox.hgrow="ALWAYS"/>
        <!-- Indicadores de paso -->
        <HBox spacing="8" alignment="CENTER">
          <Label fx:id="ind1" text="1" styleClass="indicador-activo"/>
          <Label text="â€”"              styleClass="indicador-linea"/>
          <Label fx:id="ind2" text="2" styleClass="indicador-inactivo"/>
          <Label text="â€”"              styleClass="indicador-linea"/>
          <Label fx:id="ind3" text="3" styleClass="indicador-inactivo"/>
          <Label text="â€”"              styleClass="indicador-linea"/>
          <Label fx:id="ind4" text="4" styleClass="indicador-inactivo"/>
        </HBox>
      </HBox>
    </VBox>
  </top>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CONTENIDO â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <center>
    <StackPane fx:id="stackPanePasos" styleClass="wizard-content">

      <!-- â”€â”€ PASO 0: SelecciÃ³n de tipo y archivo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
      <VBox fx:id="paso0" spacing="28" alignment="TOP_CENTER" styleClass="paso-container">
        <Label text="Â¿QuÃ© desea importar?" styleClass="paso-titulo"/>

        <HBox spacing="28" alignment="CENTER">
          <!-- Tarjeta Productos -->
          <VBox fx:id="cardProductos" styleClass="tarjeta" spacing="10"
                alignment="CENTER" onMouseClicked="#onSeleccionarProductos"
                style="-fx-padding: 24; -fx-min-width: 190; -fx-min-height: 140;">
            <Label text="ðŸ“¦" styleClass="tarjeta-icono"/>
            <Label text="Productos"               styleClass="tarjeta-titulo"/>
            <Label text="Stock, precios y proveedor" styleClass="tarjeta-desc"
                   wrapText="true" style="-fx-text-alignment: center;"/>
          </VBox>
          <!-- Tarjeta Clientes -->
          <VBox fx:id="cardClientes" styleClass="tarjeta" spacing="10"
                alignment="CENTER" onMouseClicked="#onSeleccionarClientes"
                style="-fx-padding: 24; -fx-min-width: 190; -fx-min-height: 140;">
            <Label text="ðŸ‘¥" styleClass="tarjeta-icono"/>
            <Label text="Clientes"               styleClass="tarjeta-titulo"/>
            <Label text="Contacto y crÃ©dito"     styleClass="tarjeta-desc"
                   wrapText="true" style="-fx-text-alignment: center;"/>
          </VBox>
        </HBox>

        <VBox spacing="10" alignment="CENTER">
          <Label text="Archivo seleccionado:" styleClass="form-label"/>
          <Label fx:id="lblArchivo" text="(ninguno)" styleClass="logo-path"/>
          <Button text="Seleccionar archivoâ€¦" onAction="#onSeleccionarArchivo"
                  styleClass="btn-secundario"/>
        </VBox>
      </VBox>

      <!-- â”€â”€ PASO 1: Mapeo de columnas â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
      <VBox fx:id="paso1" spacing="14" styleClass="paso-container"
            visible="false" managed="false">
        <Label text="Mapeo de columnas" styleClass="paso-titulo"/>
        <Label text="Asocia cada campo del sistema con la columna del archivo.  (* = obligatorio)"
               styleClass="tarjeta-desc" wrapText="true"/>
        <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS"
                    style="-fx-background-color: transparent; -fx-background: transparent;">
          <VBox fx:id="contenedorMapeo" spacing="0" style="-fx-padding: 4 0 4 0;"/>
        </ScrollPane>
      </VBox>

      <!-- â”€â”€ PASO 2: ValidaciÃ³n â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
      <VBox fx:id="paso2" spacing="20" alignment="TOP_CENTER" styleClass="paso-container"
            visible="false" managed="false">
        <Label text="Validando archivoâ€¦" styleClass="paso-titulo"/>
        <ProgressIndicator fx:id="progressValidacion" prefWidth="60" prefHeight="60"/>

        <!-- Panel de errores â€” visible solo si hay errores -->
        <VBox fx:id="panelErrores" spacing="10" visible="false" managed="false"
              VBox.vgrow="ALWAYS">
          <Label fx:id="lblContadorErrores" text=""
                 style="-fx-text-fill: #E53E3E; -fx-font-size: 14px; -fx-font-weight: bold;"/>
          <Label text="Corrija los errores en el archivo y vuelva a intentarlo."
                 styleClass="tarjeta-desc"/>
          <TableView fx:id="tablaErrores" VBox.vgrow="ALWAYS"/>
        </VBox>
      </VBox>

      <!-- â”€â”€ PASO 3: CategorÃ­as y subcategorÃ­as nuevas â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
      <VBox fx:id="paso3Cat" spacing="14" styleClass="paso-container"
            visible="false" managed="false">
        <Label text="CategorÃ­as y subcategorÃ­as nuevas" styleClass="paso-titulo"/>
        <Label text="Las siguientes categorÃ­as/subcategorÃ­as del archivo no existen en el sistema. Selecciona cuÃ¡les deseas crear antes de importar. Las que no marques se importarÃ¡n sin subcategorÃ­a asignada."
               styleClass="tarjeta-desc" wrapText="true"/>
        <HBox spacing="10">
          <Button text="Seleccionar todas"   onAction="#onSeleccionarTodasCategorias"
                  styleClass="btn-secundario"/>
          <Button text="Deseleccionar todas" onAction="#onDeseleccionarTodasCategorias"
                  styleClass="btn-secundario"/>
        </HBox>
        <TableView fx:id="tablaCategorias" VBox.vgrow="ALWAYS"/>
      </VBox>

      <!-- â”€â”€ PASO 4: Duplicados â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
      <VBox fx:id="paso3" spacing="14" styleClass="paso-container"
            visible="false" managed="false">
        <Label text="Registros duplicados" styleClass="paso-titulo"/>
        <Label text="Estos registros ya existen en el sistema. Elige quÃ© hacer con cada uno."
               styleClass="tarjeta-desc" wrapText="true"/>
        <HBox spacing="10">
          <Button text="Todos: Actualizar" onAction="#onMarcarTodosActualizar"
                  styleClass="btn-secundario"/>
          <Button text="Todos: Omitir"     onAction="#onMarcarTodosOmitir"
                  styleClass="btn-secundario"/>
        </HBox>
        <TableView fx:id="tablaDuplicados" VBox.vgrow="ALWAYS"/>
      </VBox>

      <!-- â”€â”€ PASO 4: Resultado â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
      <VBox fx:id="paso4" spacing="28" alignment="CENTER" styleClass="paso-container"
            visible="false" managed="false">
        <Label text="ImportaciÃ³n completada" styleClass="paso-titulo"
               style="-fx-text-fill: #276749;"/>
        <VBox spacing="14" alignment="CENTER" styleClass="tarjeta"
              style="-fx-padding: 32; -fx-min-width: 360;">
          <Label fx:id="lblImportados"   text="" styleClass="form-label"/>
          <Label fx:id="lblActualizados" text="" styleClass="form-label"/>
          <Label fx:id="lblOmitidos"     text="" styleClass="form-label"/>
        </VBox>
      </VBox>

    </StackPane>
  </center>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PIE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <bottom>
    <HBox styleClass="wizard-footer" spacing="12" alignment="CENTER_LEFT"
          style="-fx-padding: 14 32 14 32;">
      <Button fx:id="btnAnterior"          text="â† Anterior"
              onAction="#onAnterior"        styleClass="btn-secundario"/>
      <Region HBox.hgrow="ALWAYS"/>
      <Button fx:id="btnDescargarPlantilla" text="â¬‡ Descargar plantilla"
              onAction="#onDescargarPlantilla" styleClass="btn-secundario"
              visible="false" managed="false"/>
      <Button fx:id="btnDetectarAuto"      text="ðŸ” Detectar automÃ¡ticamente"
              onAction="#onDetectarAuto"    styleClass="btn-secundario"
              visible="false" managed="false"/>
      <Button fx:id="btnSiguiente"         text="Siguiente â†’"
              onAction="#onSiguiente"       styleClass="btn-primario"/>
    </HBox>
  </bottom>

</BorderPane>
